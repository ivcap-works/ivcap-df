:py:mod:`ivcap_df.schema`
=========================

.. py:module:: ivcap_df.schema


Module Contents
---------------

Classes
~~~~~~~

.. autoapisummary::

   ivcap_df.schema.Schema




Attributes
~~~~~~~~~~

.. autoapisummary::

   ivcap_df.schema.DEF_SCHEMA
   ivcap_df.schema.SUPPORTED_SCHEMAS
   ivcap_df.schema.DOT_COLORS
   ivcap_df.schema.DOT_ALPHA


.. py:data:: DEF_SCHEMA
   :value: 'https://json-schema.org/draft/2019-09/hyper-schema'

   

.. py:data:: SUPPORTED_SCHEMAS

   

.. py:data:: DOT_COLORS
   :value: ['#9e0142', '#d53e4f', '#f46d43', '#fdae61', '#fee08b', '#e6f598', '#abdda4', '#66c2a5',...

   

.. py:data:: DOT_ALPHA
   :value: '22'

   

.. py:class:: Schema(name: str, namespace: str, description: str, columns: Sequence[ivcap_df.column.Column], version=1)


   Defines the name columns of a schema.

   .. py:property:: column_names
      :type: List[str]

      Return a list of all column names

   .. py:attribute:: name
      :type: str

      

   .. py:attribute:: namespace
      :type: str

      

   .. py:attribute:: version
      :type: int

      

   .. py:attribute:: urn
      :type: str

      

   .. py:attribute:: description
      :type: str

      

   .. py:attribute:: columns
      :type: Sequence[ivcap_df.column.Column]

      

   .. py:attribute:: idColumn
      :type: ivcap_df.column.Column

      

   .. py:attribute:: urnPrefix
      :type: str

      

   .. py:attribute:: _ds
      :type: ivcap_df.dataSet.DataSet

      

   .. py:method:: load(conn: ivcap_df.connector.Connector, name: str, namespace: str, version=1) -> Schema
      :classmethod:


   .. py:method:: from_dict(dict: Dict[str, Any]) -> Schema
      :classmethod:


   .. py:method:: walk(conn: ivcap_df.connector.Connector, schemas: Collection[Union[Schema, str]], verbose=False) -> pandas.DataFrame
      :classmethod:

      Starting from the schemas defined `schemaURNs` loads all schemas reachable through RefColumns

      Return a dataframe with each row representing one of the discovered schemas

      :param conn: Connector to query data from
      :type conn: Connector
      :param schemas: A list of schemas or schema URNs
      :type schemas: Collection[Union[Schema, str]]
      :param verbose: Be chatty
      :type verbose: bool, optional

      :returns: [name:str, namespace:str, version:int, schema:Schema]
      :rtype: DataFrame


   .. py:method:: create_urn(name: str, namespace: str, version=1) -> str
      :classmethod:


   .. py:method:: parse_urn(urn: str) -> Tuple[str, str, int]
      :classmethod:


   .. py:method:: urn2urn_prefix(urn: str) -> str
      :classmethod:


   .. py:method:: to_dot(schemas: Sequence[Schema], digraph: Optional[graphviz.Digraph] = None, fontSize=12) -> graphviz.Digraph
      :classmethod:

      Return a dot DIgraph which describes the properties of the schemas
      and the links/references between them.

      Calling this from inside Jupyter will display the graph assuming graphviz is installed

      :param schemas: _description_
      :type schemas: Sequence[Schema]

      :returns: A graphiz Digraph
      :rtype: Digraph


   .. py:method:: __getitem__(colName: str) -> ivcap_df.column.Column


   .. py:method:: entity(**kwargs) -> ivcap_df.dataSet.DataItem


   .. py:method:: stage_entities(df: pandas.DataFrame, mapper=None, indexF=None) -> pandas.Series

      Create entities according to this schema for every row in 'df'

      :param df: dataframe holding an entity in every row
      :type df: DataFrame
      :param mapper: An optional mapper frpm row to named property. Defaults to None.
      :type mapper: _type_, optional
      :param indexF: Optional property name which should be used as index for returned series. Defaults to None.
      :type indexF: _type_, optional

      :raises Exception: If no mapper was found for a mandatory property

      :returns: A series containing the respective DataItem for each row in 'df'
      :rtype: Series


   .. py:method:: is_valid(df: pandas.DataFrame, verbose: Optional[bool] = False) -> bool


   .. py:method:: is_equal(other: Schema) -> bool

      Return True if 'other' is an identical schema definition


   .. py:method:: column(name: str) -> ivcap_df.column.Column

      Return the column instance for `name`

      :param name: Name of column
      :type name: str

      :returns: instance of 'Column' or None if there is no column with that name
      :rtype: Column


   .. py:method:: property(name: str) -> ivcap_df.column.Column

      Alias for 'column'


   .. py:method:: persist(connector: ivcap_df.connector.Connector, onlyEntities=False, verbose=False)

      Persist this schema as well as all staged entities

      :param connector: Connector to persistence provider
      :type connector: Connector
      :param onlyEntities: If true do NOT persist schema definition. Defaults to True.
      :type onlyEntities: bool, optional
      :param verbose: Be chatty. Defaults to False.
      :type verbose: bool, optional


   .. py:method:: create_dataframe(data: Sequence[Sequence[Any]], columns: Optional[Sequence[str]] = None, indexF: Optional[Callable[[Sequence[Any]], str]] = None, addEntityColumn=False) -> pandas.DataFrame

      Creates and returns a dataframe with columns set according to this schema.

      :param data: A sequence of rows to insert into the dataframe
      :type data: Sequence[Sequence[Any]]
      :param columns: An optional list of column names if `data` is not ordered according to schema order
      :type columns: Optional[Sequence[str]], optional
      :param indexF: If defined, this function, given the row sequencem should return the index for this row.
      :type indexF: Optional[Callable[[Sequence[Any]], str]], optional
      :param addEntityColumn: If true, add an `entity` column which combines the urn of this schema with the row's index (or `indexF`). Defaults to False.
      :type addEntityColumn: bool, optional

      :raises Exception: If `columns` contains a columns name which is not an attribute of this schema

      :returns: a dataframe with columns as defined by this schema and content as defined by `data`
      :rtype: DataFrame


   .. py:method:: persist_dataframe(connector: ivcap_df.connector.Connector, df: pandas.DataFrame, indexF: Optional[Callable[[Sequence[Any]], str]] = None, verbose=False) -> pandas.DataFrame


   .. py:method:: dataset(connector: ivcap_df.connector.Connector = None) -> ivcap_df.dataSet.DataSet

      Return all entities found for the references schema as a DataSet

      :param connector: Connector to retrieve data from. Defaults to None.
      :type connector: Connector, optional

      :raises Exception: _description_

      :returns: A dataset containing all elements found for the referenced schema
      :rtype: DataSet


   .. py:method:: get_current_dataset() -> ivcap_df.dataSet.DataSet

      Return the dataset currently associated with this schema.

          This dataset contains all the items previously fetched via `dataset` or
          added one by one through `entity`.

      :returns: A dataset containing all elements currently maintained by this schema instance
      :rtype: DataSet


   .. py:method:: query_one(query: str, local_dict: Dict[str, Any] = {}, failQuietly=False) -> ivcap_df.dataSet.DataItem

      Try to find a single data item which is returned by `query`.

      :param query: Query string as defined by panda's DataFrame#query
      :type query: str
      :param local_dict: Optionally maps '@' variables in `query` to values. Defaults to {}.
      :type local_dict: Dict[str, Any], optional
      :param failQuietly: If nothing found and set to true return None, otherwise raise exception. Defaults to False.
      :type failQuietly: bool, optional

      :raises Exception: If none or multiple entities are found and 'failQuietly' is set to False

      :returns: DataItem found as result of query
      :rtype: DataItem


   .. py:method:: query(query: str, local_dict: Dict[str, Any] = {}) -> Sequence[ivcap_df.dataSet.DataItem]

      Returns a sequence of DataItems which fulfill `query`.

      :param query: Query string as defined by panda's DataFrame#query
      :type query: str
      :param local_dict: Optionally maps '@' variables in `query` to values. Defaults to {}.
      :type local_dict: Dict[str, Any], optional

      :returns: Sequence of data items contained in this set
      :rtype: Sequence[DataItem]


   .. py:method:: create_uuid(text) -> uuid.UUID


   .. py:method:: create_entity_id(hashes: Sequence[str]) -> str


   .. py:method:: create_entity_id_mapper(indexF: Optional[Callable[[Sequence[Any]], str]] = None) -> Callable[[Sequence[Any]], str]


   .. py:method:: add_entity_id(df: pandas.DataFrame, indexF: Optional[Callable[[Sequence[Any]], str]] = None, inplace=False, override=False) -> pandas.DataFrame

      Add an Column.ENTITY_COL_NAME column holding either the result of indexF or a UUIDv5 calculated over the content of the entire row


   .. py:method:: to_json_schema(schema=DEF_SCHEMA)


   .. py:method:: df_to_json(df)


   .. py:method:: is_schema() -> bool

      Primarily used by RefColumn to identify a Schema object without importing this class (circular dependency)


   .. py:method:: graph(depth=99, digraph: Optional[graphviz.Digraph] = None, fontSize=12, verbose=False) -> graphviz.Digraph

      Return a Graphviz Digraph showing the dependency graph for all items currently known to this schema.

      :param depth: Number of levels to expand to. Defaults to 99.
      :type depth: int, optional
      :param digraph: Digraph object. If set to None, one is being created. Defaults to None.
      :type digraph: Optional[Digraph], optional
      :param fontSize: Font size for node and edge label if digraph is created internally . Defaults to 12.
      :type fontSize: int, optional
      :param verbose: If set report on items visited. Defaults to False.
      :type verbose: bool, optional

      :returns: The digraph nodes and edges have been added
      :rtype: Digraph


   .. py:method:: __repr__()

      Return repr(self).



